ğŸ“Œ LibellÃ© NOPAMA :  
  ğŸ”¹ NOPAMA     : [5131.0]
  ğŸ”¸ NOPAMA 2   : [51]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Administration
  ğŸ”¹ NOPAMA     : [7520.0, 7530.0, 7510.0]
  ğŸ”¸ NOPAMA 2   : [75]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Agriculture
  ğŸ”¹ NOPAMA     : [122.0, 131.0, 119.0, 111.0, 135.0, 117.0, 134.0, 139.0, 113.0]
  ğŸ”¸ NOPAMA 2   : [1]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Alimentaire, baoisson, tabac
  ğŸ”¹ NOPAMA     : [1560.0, 1571.0, 1530.0, 1572.0, 1583.0, 1600.0, 1521.0, 1591.0, 1581.0, 1586.0, 1592.0, 1589.0, 1510.0, 1550.0, 1523.0, 1582.0, 1540.0, 1584.0]
  ğŸ”¸ NOPAMA 2   : [15, 16]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Autres services aux entreprises
  ğŸ”¹ NOPAMA     : [7130.0, 7413.0, 7432.0, 7433.0, 7412.0, 7111.0, 7320.0, 7421.0, 7435.0, 7210.0, 7230.0, 7112.0, 7411.0, 7431.0, 7310.0, 7220.0, 7121.0, 7122.0]
  ğŸ”¸ NOPAMA 2   : [71, 74, 73, 72]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : BTP
  ğŸ”¹ NOPAMA     : [4521.0, 4522.0, 4540.0, 4510.0, 4530.0]
  ğŸ”¸ NOPAMA 2   : [45]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Banque, assurance
  ğŸ”¹ NOPAMA     : [6512.0, 6522.0, 6710.0, 6521.0, 6720.0, 6602.0, 6601.0]
  ğŸ”¸ NOPAMA 2   : [65, 67, 66]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Bois, papiers, imprimerie
  ğŸ”¹ NOPAMA     : [2022.0, 2103.0, 2220.0, 2010.0, 2024.0, 2211.0, 2102.0, 2023.0, 2101.0]
  ğŸ”¸ NOPAMA 2   : [20, 21, 22]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Commerce, entretiens, rÃ©parations
  ğŸ”¹ NOPAMA     : [5224.0, 5136.0, 5152.0, 5143.0, 5131.0, 5010.0, 5132.0, 5123.0, 5151.0, 5144.0, 5121.0, 5110.0, 5041.0, 5145.0, 5050.0, 5244.0, 5030.0, 5211.0, 5222.0, 5225.0, 5219.0, 5160.0, 5122.0, 5250.0, 5221.0, 5227.0, 5226.0, 5141.0, 5133.0, 5229.0, 5100.0, 1912.0, 5020.0, 5142.0, 1571.0]
  ğŸ”¸ NOPAMA 2   : [52, 51, 50, 19]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Education
  ğŸ”¹ NOPAMA     : [8021.0, 8010.0, 8040.0, 8030.0, 8022.0]
  ğŸ”¸ NOPAMA 2   : [80]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : ElectricitÃ©, eau, gaz
  ğŸ”¹ NOPAMA     : [4010.0, 4020.0, 4100.0]
  ğŸ”¸ NOPAMA 2   : [40, 41]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Elevage, pÃªche
  ğŸ”¹ NOPAMA     : [502.0, 501.0, 144.0, 150.0]
  ğŸ”¸ NOPAMA 2   : [5, 3]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : HÃ´tel, restaurant
  ğŸ”¹ NOPAMA     : [5521.0, 5510.0, 5522.0]
  ğŸ”¸ NOPAMA 2   : [55]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Industrie chimique et pharmaceutique
  ğŸ”¹ NOPAMA     : [2412.0, 2443.0, 2431.0, 2411.0, 2442.0, 2520.0, 2422.0, 2511.0, 2421.0]
  ğŸ”¸ NOPAMA 2   : [24, 25]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Industrie exctractive
  ğŸ”¹ NOPAMA     : [1422.0, 1431.0, 1321.0, 1439.0, 1432.0, 1410.0]
  ğŸ”¸ NOPAMA 2   : [14, 13]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Industrie mÃ©tallique
  ğŸ”¹ NOPAMA     : [2810.0, 2823.0, 2824.0]
  ğŸ”¸ NOPAMA 2   : [28]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Industrie mÃ©tallurgique
  ğŸ”¹ NOPAMA     : [2720.0, 2710.0]
  ğŸ”¸ NOPAMA 2   : [27]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Industries diverses
  ğŸ”¹ NOPAMA     : [3611.0, 3629.0, 3621.0]
  ğŸ”¸ NOPAMA 2   : [36]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Machine, matÃ©riels  Ã©lectriques
  ğŸ”¹ NOPAMA     : [3300.0, 2920.0, 3511.0, 2910.0, 3100.0, 3200.0]
  ğŸ”¸ NOPAMA 2   : [33, 29, 35, 31, 32]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : MatÃ©riaux de construction
  ğŸ”¹ NOPAMA     : [2610.0, 2632.0, 2633.0, 2631.0]
  ğŸ”¸ NOPAMA 2   : [26]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Missing
  ğŸ”¹ NOPAMA     : [2310.0, 5223.0, 7422.0, 3624.0, 5220.0, 6220.0, 2432.0, 1329.0, 6021.0, 1220.0, 9304.0, 1110.0, 1190.0]
  ğŸ”¸ NOPAMA 2   : ['Missing']
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Poste et tÃ©lÃ©communication
  ğŸ”¹ NOPAMA     : [6422.0, 6421.0, 6410.0]
  ğŸ”¸ NOPAMA 2   : [64]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Produits pÃ©troliers
  ğŸ”¹ NOPAMA     : [2320.0]
  ğŸ”¸ NOPAMA 2   : [23]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : SIFIM
  ğŸ”¹ NOPAMA     : [9700.0]
  ğŸ”¸ NOPAMA 2   : [97]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : SantÃ©
  ğŸ”¹ NOPAMA     : [8511.0, 8512.0, 8530.0, 8519.0, 8510.0, 9000.0]
  ğŸ”¸ NOPAMA 2   : [85, 90]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Services immobilers
  ğŸ”¹ NOPAMA     : [7020.0, 7011.0, 7012.0]
  ğŸ”¸ NOPAMA 2   : [70]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Services rendus aux mÃ©nages
  ğŸ”¹ NOPAMA     : [9133.0, 9302.0, 9219.0, 9131.0, 9110.0, 9242.0, 9212.0, 9241.0, 9211.0, 9510.0, 9230.0]
  ğŸ”¸ NOPAMA 2   : [91, 93, 92, 95]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Sylviculture
  ğŸ”¹ NOPAMA     : [212.0]
  ğŸ”¸ NOPAMA 2   : [2]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Textile
  ğŸ”¹ NOPAMA     : [1710.0, 1911.0, 1722.0, 1801.0, 1724.0, 1912.0, 1730.0, 1920.0, 1802.0]
  ğŸ”¸ NOPAMA 2   : [17, 19, 18]
------------------------------------------------------------
ğŸ“Œ LibellÃ© NOPAMA : Transport
  ğŸ”¹ NOPAMA     : [6020.0, 6323.0, 6332.0, 6331.0, 6030.0, 6200.0, 6311.0, 6110.0, 6010.0, 6312.0, 6322.0, 6120.0]
  ğŸ”¸ NOPAMA 2   : [60, 63, 62, 61]
------------------------------------------------------------
























from flask import Flask, request, jsonify
import re
import nltk
from nltk.tokenize import word_tokenize
from nltk.stem import WordNetLemmatizer
from nltk.corpus import stopwords
import json
import joblib

# TÃ©lÃ©charger les ressources nÃ©cessaires pour nltk
nltk.download('punkt')
nltk.download('wordnet')
nltk.download('stopwords')

app = Flask(__name__)

lemmatizer = WordNetLemmatizer()
stop_words = set(stopwords.words('french'))  # Utilisation des stopwords en franÃ§ais

# Charger le modÃ¨le et le label encoder
# model = joblib.load("Model_Final.joblib")

model_path = r"C:\Users\AINA KEVIN\Desktop\Project NIFF STAT\API\Model_Final.joblib"
model = joblib.load(model_path)
label_path = r"C:\Users\AINA KEVIN\Desktop\Project NIFF STAT\API\Label.joblib"
data_path = r"C:\Users\AINA KEVIN\Desktop\Project NIFF STAT\API\data.json"
label_encoder = joblib.load(label_path)

abbreviations = {
    "vent": "vente",
    "tts": "toutes",
    "consom": "consommables",
    "dgi": "direction gÃ©nÃ©rale des impÃ´ts",
    "dco": "direction du contrÃ´le",
    "drivak": "direction de la recherche, innovation, valorisation et acquisition de connaissances",  # hypothÃ¨se Ã  confirmer selon contexte
    "informatiq": "informatique",
    "matl": "matÃ©riel"
}
# ğŸ” Remplacer les abrÃ©viations
# Charger le fichier JSON
with open(data_path, "r", encoding="utf-8") as file:
    data_code = json.load(file)
def replace_abbreviations(text):
    if not isinstance(text, str):
        return text
    for abbr, full in sorted(abbreviations.items(), key=lambda x: -len(x[0])):
        pattern = r'\b' + re.escape(abbr) + r'\b'
        text = re.sub(pattern, full, text)
    return text

# ğŸ§¼ Nettoyage du texte
def clean_text(text):
    text = str(text).lower()
    text = re.sub(r'\d+', ' ', text)                
    text = re.sub(r'[^\w\s]', ' ', text)            
    tokens = text.split()
    tokens = [word for word in tokens if word not in stop_words]
    return ' '.join(tokens)

# ğŸ§  Tokenisation + lemmatisation
def tokenize_and_lemmatize(text):
    tokens = word_tokenize(text)
    lemmatized = [lemmatizer.lemmatize(token) for token in tokens]
    return lemmatized

@app.route('/')
def home():
    return "Bienvenue sur mon API de traitement de texte avec NLTK"

@app.route('/predict', methods=['GET'])
def predict():
    data = request.get_json()

    if not data or 'texte' not in data:
        return jsonify({'error': 'Champ "texte" manquant'}), 400

    raw_text = data['texte']

    # Ã‰tapes de traitement du texte
    text = replace_abbreviations(raw_text)
    cleaned_text = clean_text(text)

    try:
        # PrÃ©diction
        prediction = model.predict([cleaned_text])[0]
        label = label_encoder.inverse_transform([prediction])[0]

        # Recherche du libellÃ© correspondant dans le fichier JSON
        resultat = next((item for item in data_code if item["Libelle NOPAMA"] == label), None)

        if not resultat:
            return jsonify({
                'texte_nettoye': cleaned_text,
                'prediction': label,
                'message': 'LibellÃ© non trouvÃ© dans le fichier JSON'
            }), 200

        return jsonify({
            'texte_nettoye': cleaned_text,
            'prediction': label,
            'NOPAMA': resultat["NOPAMA"],
            'NOPAMA 2': resultat["NOPAMA 2"]
        }), 200

    except Exception as e:
        return jsonify({'error': f'Erreur pendant la prÃ©diction : {str(e)}'}), 500

if __name__ == '__main__':
    app.run(debug=True)





